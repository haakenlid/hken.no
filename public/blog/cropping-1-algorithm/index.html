<!DOCTYPE html>
 <html lang="en"><head><title></title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="user-scalable=no width=device-width, initial-scale=1.0 maximum-scale=1.0"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="haken.no"/><link rel="manifest" href="/favicon/manifest.json"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-chrome-192x192.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="230x230" href="/favicon/favicon-230x230.png"/><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon-180x180.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="haken.no"/><link rel="stylesheet" href="/styles.css"/></head><body><div id="react-mount"><article class="Page" data-reactroot="" data-reactid="1" data-react-checksum="1865406851"><header class="PageHeader" data-reactid="2"><nav class="PageNav" data-reactid="3"><div class="TitleBar animate" data-reactid="4"><a href="/" data-reactid="5"><svg class="Icon Monogram" viewBox="0 0 64 64" data-reactid="6"><path d="m 10.833,16.877 c -0.036,-2.862 2.141,-4.665 5.435,-4.076 3.294,0.589
      4.047,4.759 1.882,6.950 -2.941,2.945 -9.364,2.945 -12.234,-0.707
        -5.141,-6.361 1.494,-16.256 10.940,-15.432 6.329,0.568 11.034,7.386
      10.576,13.665 -0.314,4.241 -1.859,8.788 -4.000,12.958 -2.576,5.018
        -7.176,9.471 -12.940,9.659 -3.294,0.107 -6.894,-2.356 -6.352,-5.890
      0.699,-4.594 5.764,-6.997 9.999,-7.421 8.235,-0.821 16.469,0.941
      24.704,-0.019 7.105,-0.832 16.587,-3.934 20.469,-11.273 1.682,-3.192
      2.400,-7.197 -1.039,-9.930 -3.423,-2.721 -9.329,-0.954 -12.352,1.178
        -5.188,3.687 -7.788,10.354 -9.646,16.492 -3.200,10.590 -6.235,21.557
        -12.940,30.627 -2.823,3.840 -7.646,7.292 -12.940,6.125 -3.176,-0.699
        -6.823,-5.207 -5.964,-8.269 1.188,-4.241 4.823,-5.030 8.940,-5.478
      6.588,-0.703 14.352,3.510 19.057,7.386 4.094,3.428 9.164,7.516
      15.293,6.479 7.399,-1.249 11.999,-8.599 12.940,-15.314 0.736,-5.301
        -1.823,-11.250 -7.176,-12.958 -7.235,-2.309 -15.293,2.603 -16.469,9.659
        -0.669,3.899 2.812,7.033 6.470,7.657 4.341,0.749 8.505,-3.181
      7.882,-7.421 -0.463,-3.181 -7.658,-3.864 -7.752,0.958 -0.126,6.467
        -8.329,9.000 -13.411,8.022 -9.058,-1.767 -16.234,-12.251
        -16.822,-21.793 -1.000,-13.782 10.587,-28.036 28.115,-21.910
      2.882,1.008 6.258,4.335 6.917,6.785 1.412,5.207 0.755,8.458 1.553,12.015
      1.176,5.254 3.176,7.468 4.200,6.997 1.020,-0.464 1.306,-1.885
      1.259,-4.653 -0.074,-4.264 -0.921,-4.229 -2.882,-4.135 -2.588,0.126
        -8.129,0.707 -15.763,0.915 -2.835,0.077 -2.541,2.038 -2.800,2.061
        -6.035,0.349 -11.281,0.451 -13.999,0.756 l 0.289,0.588 c 6.294,-0.517
      10.634,-0.647 13.646,-0.813 0.135,4.818 1.388,6.055 4.576,6.279
      2.341,0.117 4.905,-0.914 5.905,-2.556 2.223,-3.652 1.235,-5.489
      3.811,-5.513 1.753,-0.018 3.588,5.560 4.776,8.505 1.089,2.709 3.529,5.843
      2.000,8.670 -1.294,2.391 -7.999,0.742 -7.999,0.742 0,0 1.270,3.887
        -0.259,3.887 -2.823,-0.007 -8.588,0.353 -10.117,-4.123 1.647,4.406
      7.294,4.123 10.117,4.123 1.176,1.120e-4 0.508,0.825 1.294,5.301
      0.414,2.356 0.672,4.783 -1.118,6.008 -5.894,4.040 -16.352,-1.649
        -20.822,-4.406 -4.376,-2.674 -8.811,-5.902 -11.764,-10.484
        -1.518,-2.368 0.765,-5.430 1.647,-6.008 -3.647,2.945 -4.882,-3.063
        -5.647,-6.008 -0.951,-3.652 0.229,-9.282 6.117,-8.128 3.764,0.735
      3.882,7.975 6.588,8.364 3.294,0.478 2.800,-6.585 1.529,-9.070
        -1.494,-2.933 -3.741,-6.585 -2.353,-9.895 1.318,-3.110 5.529,-2.544
      8.352,-2.120 4.117,0.615 9.340,2.780 13.646,1.133 3.764,-1.449
        -2.823,-6.550 -8.235,-7.598 -4.941,-0.931 -13.175,-2.603 -21.763,2.179
        -5.329,2.969 -8.717,8.481 -9.529,14.489 -1.223,9.070 2.447,17.081
      9.411,22.028 6.352,4.712 17.175,4.359 14.352,-7.775 -2.353,-10.013
        -17.410,-10.837 -17.528,-18.494 z" class="face" data-reactid="7"></path></svg></a><h1 data-reactid="8">Lazy image cropping</h1></div><div class="Logo animate" data-reactid="9"><a href="/" data-reactid="10"><svg class="Icon Monogram" viewBox="0 0 64 64" data-reactid="11"><path d="m 10.833,16.877 c -0.036,-2.862 2.141,-4.665 5.435,-4.076 3.294,0.589
      4.047,4.759 1.882,6.950 -2.941,2.945 -9.364,2.945 -12.234,-0.707
        -5.141,-6.361 1.494,-16.256 10.940,-15.432 6.329,0.568 11.034,7.386
      10.576,13.665 -0.314,4.241 -1.859,8.788 -4.000,12.958 -2.576,5.018
        -7.176,9.471 -12.940,9.659 -3.294,0.107 -6.894,-2.356 -6.352,-5.890
      0.699,-4.594 5.764,-6.997 9.999,-7.421 8.235,-0.821 16.469,0.941
      24.704,-0.019 7.105,-0.832 16.587,-3.934 20.469,-11.273 1.682,-3.192
      2.400,-7.197 -1.039,-9.930 -3.423,-2.721 -9.329,-0.954 -12.352,1.178
        -5.188,3.687 -7.788,10.354 -9.646,16.492 -3.200,10.590 -6.235,21.557
        -12.940,30.627 -2.823,3.840 -7.646,7.292 -12.940,6.125 -3.176,-0.699
        -6.823,-5.207 -5.964,-8.269 1.188,-4.241 4.823,-5.030 8.940,-5.478
      6.588,-0.703 14.352,3.510 19.057,7.386 4.094,3.428 9.164,7.516
      15.293,6.479 7.399,-1.249 11.999,-8.599 12.940,-15.314 0.736,-5.301
        -1.823,-11.250 -7.176,-12.958 -7.235,-2.309 -15.293,2.603 -16.469,9.659
        -0.669,3.899 2.812,7.033 6.470,7.657 4.341,0.749 8.505,-3.181
      7.882,-7.421 -0.463,-3.181 -7.658,-3.864 -7.752,0.958 -0.126,6.467
        -8.329,9.000 -13.411,8.022 -9.058,-1.767 -16.234,-12.251
        -16.822,-21.793 -1.000,-13.782 10.587,-28.036 28.115,-21.910
      2.882,1.008 6.258,4.335 6.917,6.785 1.412,5.207 0.755,8.458 1.553,12.015
      1.176,5.254 3.176,7.468 4.200,6.997 1.020,-0.464 1.306,-1.885
      1.259,-4.653 -0.074,-4.264 -0.921,-4.229 -2.882,-4.135 -2.588,0.126
        -8.129,0.707 -15.763,0.915 -2.835,0.077 -2.541,2.038 -2.800,2.061
        -6.035,0.349 -11.281,0.451 -13.999,0.756 l 0.289,0.588 c 6.294,-0.517
      10.634,-0.647 13.646,-0.813 0.135,4.818 1.388,6.055 4.576,6.279
      2.341,0.117 4.905,-0.914 5.905,-2.556 2.223,-3.652 1.235,-5.489
      3.811,-5.513 1.753,-0.018 3.588,5.560 4.776,8.505 1.089,2.709 3.529,5.843
      2.000,8.670 -1.294,2.391 -7.999,0.742 -7.999,0.742 0,0 1.270,3.887
        -0.259,3.887 -2.823,-0.007 -8.588,0.353 -10.117,-4.123 1.647,4.406
      7.294,4.123 10.117,4.123 1.176,1.120e-4 0.508,0.825 1.294,5.301
      0.414,2.356 0.672,4.783 -1.118,6.008 -5.894,4.040 -16.352,-1.649
        -20.822,-4.406 -4.376,-2.674 -8.811,-5.902 -11.764,-10.484
        -1.518,-2.368 0.765,-5.430 1.647,-6.008 -3.647,2.945 -4.882,-3.063
        -5.647,-6.008 -0.951,-3.652 0.229,-9.282 6.117,-8.128 3.764,0.735
      3.882,7.975 6.588,8.364 3.294,0.478 2.800,-6.585 1.529,-9.070
        -1.494,-2.933 -3.741,-6.585 -2.353,-9.895 1.318,-3.110 5.529,-2.544
      8.352,-2.120 4.117,0.615 9.340,2.780 13.646,1.133 3.764,-1.449
        -2.823,-6.550 -8.235,-7.598 -4.941,-0.931 -13.175,-2.603 -21.763,2.179
        -5.329,2.969 -8.717,8.481 -9.529,14.489 -1.223,9.070 2.447,17.081
      9.411,22.028 6.352,4.712 17.175,4.359 14.352,-7.775 -2.353,-10.013
        -17.410,-10.837 -17.528,-18.494 z" class="face" data-reactid="12"></path></svg></a></div><section class="sidebar" data-reactid="13"><div class="BlogPostNavigation" data-reactid="14"><h1 data-reactid="15">In this article:</h1><section class="TableOfContents" data-reactid="16"><nav class="TableOfContents" data-reactid="17"><div class="TocHeader H1 active" data-reactid="18">Lazy image cropping</div><div class="TocHeader H2" data-reactid="19">Demo</div><div class="TocHeader H2" data-reactid="20">How it works</div><div class="TocHeader H2" data-reactid="21">Algorithm</div><div class="TocHeader H2" data-reactid="22">What’s next</div></nav></section><h1 data-reactid="23">Read Next:</h1><section class="ReadNext" data-reactid="24"><article class="Teaser" data-reactid="25"><a href="/blog/cropping-3-python/" data-reactid="26"><img src="/blog/cropping-3-python/./index.jpg" alt="How to use computer vision to crop images" data-reactid="27"/><h1 data-reactid="28">How to use computer vision to crop images</h1></a></article><article class="Teaser" data-reactid="29"><a href="/blog/cropping-2-react/" data-reactid="30"><!-- react-text: 31 --><!-- /react-text --><h1 data-reactid="32">Untitled</h1></a></article></section></div><section class="SocialMedia" data-reactid="33"><a href="https://github.com/haakenlid" title="github" data-reactid="34"><svg class="Icon GitHub Social" viewBox="0 0 64 64" data-reactid="35"><path d="m 24.285,59.211 c -0.015,-1.577 -0.022,-7.273 -0.022,-8.462 l -1.077,0.190 c -3.962,0.731 -9.569,-0.038 -11.077,-4.462 l -0.465,-1.077 c -0.758,-1.758 -1.931,-3.158 -3.527,-4.192 l -0.328,-0.240 c -1.312,-0.927 -1.400,-1.977 0.562,-1.977 l 0.938,0.138 c 1.869,0.373 3.677,1.985 4.616,3.573 2.231,3.915 6.462,4.942 10.500,3.012 0.292,-2.100 1.058,-3.715 2.312,-4.846 -12.760,-1.346 -23.116,-16.347 -12.731,-27.501 -1.160,-2.846 -1.077,-6.769 0.300,-10.311 3.038,-0.938 7.577,2.077 9.962,3.720 5.846,-1.639 12.193,-1.639 18.039,0 l 1.792,-1.131 c 2.019,-1.246 5.616,-3.389 8.116,-2.589 1.408,3.542 1.538,6.731 0.372,9.577 10.385,11.193 -0.007,26.155 -12.808,27.501 1.627,1.415 2.450,3.639 2.450,6.692 l 0,12.287" data-reactid="36"></path></svg></a><a href="http://codepen.io/haakenlid/" title="codepen" data-reactid="37"><svg class="Icon CodePen Social" viewBox="0 0 64 64" data-reactid="38"><path d="m 4.428,23.059 27.885,18.577 0,18.577 L 4.428,41.636 m 27.885,0 27.885,-18.577 0,18.577 -27.885,18.577 m 27.885,-18.577 -27.885,-18.577 0,-18.577 27.885,18.577 m -27.885,0 -27.885,18.577 0,-18.577 L 32.313,4.482" data-reactid="39"></path></svg></a><a href="http://stackoverflow.com/users/1977847/?tab=profile" title="stack overflow" data-reactid="40"><svg class="Icon StackOverflow Social" viewBox="0 0 64 64" data-reactid="41"><path d="m 44.968,40.983 -27.462,-5.577 m 4.192,-12.847 25.270,11.808 m 3.754,-5.923 -21.424,-17.885 M 39.183,1.174 55.722,23.521 m -39.616,24.501 27.885,0 m -36.155,-8.346 0,19.539 44.232,0 0,-19.539" data-reactid="42"></path></svg></a></section></section></nav></header><main class="BlogPost" data-reactid="43"><div class="BlogPostHeader" data-reactid="44"><div class="BlogPostData" data-reactid="45"><span class="ByLine" data-reactid="46"><!-- react-text: 47 --> <!-- /react-text --><svg class="Icon" id="SoftwarePen" viewBox="0 0 64 64" data-reactid="48"><rect height="6" width="18" x="23" y="57" data-reactid="49"></rect><rect height="10" width="26" x="19" y="47" data-reactid="50"></rect><polyline points="41,47 41,43 48,30 32,1 16,30 23,43 23,47" data-reactid="51"></polyline><circle cx="32" cy="28.875" r="4" data-reactid="52"></circle><line x1="32" x2="32" y1="1" y2="25" data-reactid="53"></line></svg><!-- react-text: 54 --> <!-- /react-text --><!-- react-text: 55 -->Håken Lid<!-- /react-text --><!-- react-text: 56 --> <!-- /react-text --></span><span class="DateLine" data-reactid="57"><!-- react-text: 58 --> <!-- /react-text --><svg class="Icon" id="BasicWatch" viewBox="0 0 64 64" data-reactid="59"><circle cx="32" cy="32" r="20" data-reactid="60"></circle><polyline points="20,15 20,1 44,1 44,15" data-reactid="61"></polyline><polyline points="44,49 44,63 20,63 20,49" data-reactid="62"></polyline><polyline points="32,20 32,32 40,36" data-reactid="63"></polyline></svg><!-- react-text: 64 --> <!-- /react-text --><!-- react-text: 65 -->6 months ago<!-- /react-text --><!-- react-text: 66 --> <!-- /react-text --></span><span class="Tags" data-reactid="67"><!-- react-text: 68 --> <!-- /react-text --><svg class="Icon" id="EcommerceSales" viewBox="0 0 64 64" data-reactid="69"><polygon points="21.903,5 55,38.097 34.097,59 1,25.903 1,5" data-reactid="70"></polygon><polyline points="29.903,5 63,38.097 42.097,59" data-reactid="71"></polyline><circle cx="14" cy="18" r="5" data-reactid="72"></circle></svg><!-- react-text: 73 --> <!-- /react-text --><!-- react-text: 74 -->react, svg, es6, cropping<!-- /react-text --><!-- react-text: 75 --> <!-- /react-text --></span></div><img src="./index.jpg" data-reactid="76"/><h1 class="title" data-reactid="77">Lazy image cropping</h1></div><div class="markdown" data-reactid="78"><p>This is the first in a series of blog entries about image cropping. The idea of
image cropping is quite simple. We cut away parts of the original image to fit
into whatever final shape we need to put it into for publication. We might also
want have the most important part of the motive fill as much of the image frame
as possible.</p>
<p>The challenge is that a single source image often ends up being used in various
final shapes, and we don&#x2019;t want to prepare a bunch of different pre-cropped
versions of the same image. If we can determine which regions of the full image
are the most important, the final cropping can be done by a simple computer
algorithm at the point of publication. That is lazily. The point of publication
can be either in the web browser with css or javascript, in a desktop publishing
application (Adobe InDesign) or on the web server.</p>
<p>I call this &#xAB;lazy&#xBB; image cropping, because once the input parameters to the
algorithm have been provided, the algorithm works with the same parameters for
any output shape, so the final crop can be done at the latest possible time.</p>
<h2 id="1-Demo" title="1-Demo"><a class="Header" href="#1-Demo">Demo</a></h2>
<p>This is a javascript implementation of the algorithm. Try to move or resize the
white crop box or the yellow point of interest by clicking and dragging with the
mouse. The previews below shows the final output with three different output
formats.</p>
</div><div class="cropboxWrapper" style="flex-direction:column;display:flex;" data-reactid="79"><div class="masterImgWrapper infoParent" data-reactid="80"><img class="masterImg" src="./11-NYH-nyhklarefors-06-SGS.jpg" data-reactid="81"/><div class="overlayWrapper" data-reactid="82"><svg class="overlay" viewBox="0 0 1 1" preserveAspectRatio="none" height="100%" width="100%" data-reactid="83"><defs data-reactid="84"><symbol id="profile-face" viewBox="0 0 100 100" data-reactid="85"><path d="m15.3 69.6c-2.7-1.8-10.1-3.3-7.91-7.2 2.91-5.2 9.11-11.9
          8.21-17.5-4-24.2 10-39.8 33.9-39.9 24-.09 37.5 12.8 37.5 38.2 0
          35.7-51.1 60.8-59.8 48.5-8.8-12.6-7.6-17.4-11.9-22.1z" data-reactid="86"></path></symbol><symbol id="frontal-face" viewBox="0 0 100 100" data-reactid="87"><path d="m50 5c-12.8 0-25.8 7.73-30 16.9-4.19 9.17-.562 14.4-.768
          29.3-.205 15 6.92 30 13.4 34.9 6.49 4.88 11.3 8.89 17.3 8.89 6.04
          0 10.8-4.01 17.3-8.89 6.6-4.9 13.7-19.9 13.5-34.9-.2-14.9
          3.5-20.1-.7-29.3s-17.2-16.9-30-16.9z" data-reactid="88"></path></symbol></defs><path class="outside" fill-rule="evenodd" d="M0, 0H1V1H0ZM0.1, 0.1V0.9H0.9V0.1Z" data-reactid="89"></path><g class="inside" data-reactid="90"><path class="box" d="M0.1, 0.1V0.9H0.9V0.1Z" data-reactid="91"></path><svg class="handles" viewBox="0 0 1 1" preserveAspectRatio="none" height="0.8" width="0.8" x="0.1" y="0.1" data-reactid="92"><rect class="1000" width="0.1" height="1.1" x="-0.05" y="-0.05" style="cursor:ew-resize;" data-reactid="93"></rect><rect class="0100" width="1.1" height="0.1" x="-0.05" y="-0.05" style="cursor:ns-resize;" data-reactid="94"></rect><rect class="0010" width="0.1" height="1.1" x="0.95" y="-0.05" style="cursor:ew-resize;" data-reactid="95"></rect><rect class="0001" width="1.1" height="0.1" x="-0.05" y="0.95" style="cursor:ns-resize;" data-reactid="96"></rect><rect class="1100" width="0.1" height="0.1" x="-0.05" y="-0.05" style="cursor:nw-resize;" data-reactid="97"></rect><rect class="0110" width="0.1" height="0.1" x="0.95" y="-0.05" style="cursor:ne-resize;" data-reactid="98"></rect><rect class="0011" width="0.1" height="0.1" x="0.95" y="0.95" style="cursor:se-resize;" data-reactid="99"></rect><rect class="1001" width="0.1" height="0.1" x="-0.05" y="0.95" style="cursor:sw-resize;" data-reactid="100"></rect></svg></g><g class="centerPoint" data-reactid="101"><ellipse class="handle" style="opacity:0;" cx="0.5" cy="0.5" rx="0.05" ry="0.05" data-reactid="102"></ellipse><path class="cross" d="M0, 0.5H1M0.5, 0V1" data-reactid="103"></path></g></svg></div><div class="infoBoxWrapper" data-reactid="104"><div class="infoBox" data-reactid="105"><div class="infoRow" data-reactid="106"><div class="label" data-reactid="107"><!-- react-text: 108 -->left<!-- /react-text --><!-- react-text: 109 -->:<!-- /react-text --></div><div class="value" data-reactid="110">0.100</div></div><div class="infoRow" data-reactid="111"><div class="label" data-reactid="112"><!-- react-text: 113 -->top<!-- /react-text --><!-- react-text: 114 -->:<!-- /react-text --></div><div class="value" data-reactid="115">0.100</div></div><div class="infoRow" data-reactid="116"><div class="label" data-reactid="117"><!-- react-text: 118 -->right<!-- /react-text --><!-- react-text: 119 -->:<!-- /react-text --></div><div class="value" data-reactid="120">0.900</div></div><div class="infoRow" data-reactid="121"><div class="label" data-reactid="122"><!-- react-text: 123 -->bottom<!-- /react-text --><!-- react-text: 124 -->:<!-- /react-text --></div><div class="value" data-reactid="125">0.900</div></div><div class="infoRow" data-reactid="126"><div class="label" data-reactid="127"><!-- react-text: 128 -->x<!-- /react-text --><!-- react-text: 129 -->:<!-- /react-text --></div><div class="value" data-reactid="130">0.500</div></div><div class="infoRow" data-reactid="131"><div class="label" data-reactid="132"><!-- react-text: 133 -->y<!-- /react-text --><!-- react-text: 134 -->:<!-- /react-text --></div><div class="value" data-reactid="135">0.500</div></div></div></div></div><div class="previewPanel" style="flex-direction:row;" data-reactid="136"><div class="previewWrapper infoParent" style="flex:1;" data-reactid="137"><svg class="previewImg" style="background-image:url(./11-NYH-nyhklarefors-06-SGS.jpg);background-position:NaN% NaN%;background-repeat:no-repeat;background-size:NaN% auto;" viewBox="0 0 1 1" data-reactid="138"></svg><div class="infoBoxWrapper" data-reactid="139"><div class="infoBox" data-reactid="140"><div class="infoRow" data-reactid="141"><div class="label" data-reactid="142"><!-- react-text: 143 -->position<!-- /react-text --><!-- react-text: 144 -->:<!-- /react-text --></div><div class="value" data-reactid="145">NaN% NaN%</div></div><div class="infoRow" data-reactid="146"><div class="label" data-reactid="147"><!-- react-text: 148 -->size<!-- /react-text --><!-- react-text: 149 -->:<!-- /react-text --></div><div class="value" data-reactid="150">NaN% auto</div></div><div class="infoRow" data-reactid="151"><div class="label" data-reactid="152"><!-- react-text: 153 -->aspect ratio<!-- /react-text --><!-- react-text: 154 -->:<!-- /react-text --></div><div class="value" data-reactid="155">1</div></div></div></div></div><div class="previewWrapper infoParent" style="flex:0.5;" data-reactid="156"><svg class="previewImg" style="background-image:url(./11-NYH-nyhklarefors-06-SGS.jpg);background-position:NaN% NaN%;background-repeat:no-repeat;background-size:NaN% auto;" viewBox="0 0 0.5 1" data-reactid="157"></svg><div class="infoBoxWrapper" data-reactid="158"><div class="infoBox" data-reactid="159"><div class="infoRow" data-reactid="160"><div class="label" data-reactid="161"><!-- react-text: 162 -->position<!-- /react-text --><!-- react-text: 163 -->:<!-- /react-text --></div><div class="value" data-reactid="164">NaN% NaN%</div></div><div class="infoRow" data-reactid="165"><div class="label" data-reactid="166"><!-- react-text: 167 -->size<!-- /react-text --><!-- react-text: 168 -->:<!-- /react-text --></div><div class="value" data-reactid="169">NaN% auto</div></div><div class="infoRow" data-reactid="170"><div class="label" data-reactid="171"><!-- react-text: 172 -->aspect ratio<!-- /react-text --><!-- react-text: 173 -->:<!-- /react-text --></div><div class="value" data-reactid="174">0.5</div></div></div></div></div><div class="previewWrapper infoParent" style="flex:2.5;" data-reactid="175"><svg class="previewImg" style="background-image:url(./11-NYH-nyhklarefors-06-SGS.jpg);background-position:NaN% NaN%;background-repeat:no-repeat;background-size:NaN% auto;" viewBox="0 0 2.5 1" data-reactid="176"></svg><div class="infoBoxWrapper" data-reactid="177"><div class="infoBox" data-reactid="178"><div class="infoRow" data-reactid="179"><div class="label" data-reactid="180"><!-- react-text: 181 -->position<!-- /react-text --><!-- react-text: 182 -->:<!-- /react-text --></div><div class="value" data-reactid="183">NaN% NaN%</div></div><div class="infoRow" data-reactid="184"><div class="label" data-reactid="185"><!-- react-text: 186 -->size<!-- /react-text --><!-- react-text: 187 -->:<!-- /react-text --></div><div class="value" data-reactid="188">NaN% auto</div></div><div class="infoRow" data-reactid="189"><div class="label" data-reactid="190"><!-- react-text: 191 -->aspect ratio<!-- /react-text --><!-- react-text: 192 -->:<!-- /react-text --></div><div class="value" data-reactid="193">2.5</div></div></div></div></div></div></div><div class="markdown" data-reactid="194"><p>This demo is implemented with react.js using svg for the widgets and css
background properties for the previews.</p>
<h2 id="2-How-it-works" title="2-How-it-works"><a class="Header" href="#2-How-it-works">How it works</a></h2>
<p>A very simple cropping algorithm would be simply to crop evenly from both sides
either horizontally or vertically until we get the final output shape. We can
improve this by providing a single point of interest (POI), and crop the image
using this as a center point if possible.</p>
<p>The disadvantage of this is that we end up with a very wide crop. This looks
good in a full screen or full page layout, but if the final image is smaller,
it&#x2019;s better to crop away empty space around the main motive.</p>
<p>It turns out that we can get good results by combining the point of interest
with a &#xAB;crop box&#xBB;. Anything outside of the crop box should be cropped away
if possible. But when the output format so wide or narrow that we also have to
crop into the crop box itself, it&#x2019;s done in a way that always keeps the POI
inside the image frame.</p>
<h2 id="3-Algorithm" title="3-Algorithm"><a class="Header" href="#3-Algorithm">Algorithm</a></h2>
<p>The algorithm itself is just some simple arithmetic. Here&#x2019;s the javascript
implementation that I use for this demo. This function uses a coordinate system
where the width and height is both 1. It therefore has to be wrapped in a
function that converts the relative values to the actual width and height of the
image and of the output format.</p>
</div><pre class="CodeBlock" data-reactid="195"><code class="lang-javascript" data-reactid="196"><span class="hljs-keyword">const</span> closeCrop = <span class="hljs-function">(<span class="hljs-params">x, y, l, r, t, b, A</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> w = r - l
	<span class="hljs-keyword">const</span> h = b - t
	<span class="hljs-keyword">const</span> a = w / h
	<span class="hljs-keyword">const</span> W = <span class="hljs-number">0.5</span> * <span class="hljs-built_in">Math</span>.min(A, <span class="hljs-number">1</span>, a &gt; A ? w : h * A)
	<span class="hljs-keyword">const</span> H = W / A
	<span class="hljs-keyword">const</span> [X, Y] = [
		W * <span class="hljs-number">2</span> &gt; w ?
			[W, (l + r) / <span class="hljs-number">2</span>, <span class="hljs-number">1</span> - W] :
			[l + W, x, r - W],
		H * <span class="hljs-number">2</span> &gt; h ?
			[H, (t + b) / <span class="hljs-number">2</span>, <span class="hljs-number">1</span> - H] :
			[t + H, y, b - H],
	].map(<span class="hljs-function"><span class="hljs-params">triple</span> =&gt;</span> triple.sort(<span class="hljs-function">(<span class="hljs-params">n, m</span>) =&gt;</span> n - m)[<span class="hljs-number">1</span>])
	<span class="hljs-keyword">return</span> {
		<span class="hljs-attr">left</span>: X - W,
		<span class="hljs-attr">right</span>: X + W,
		<span class="hljs-attr">top</span>: Y - H,
		<span class="hljs-attr">bottom</span>: Y + H,
	}
}</code></pre><div class="markdown" data-reactid="197"><h2 id="4-Whats-next" title="4-Whats-next"><a class="Header" href="#4-Whats-next">What&#x2019;s next</a></h2>
<p>In the next blog entry I&#x2019;ll explain the client side cropping widget in a bit more
detail. It&#x2019;s meant to be used in a publication workflow for photographers or art
directors.</p>
<p>In the third blog entry I&#x2019;ll give an example of how to find the initial cropping
parameters to this algorithm using computer vision to find faces and salient
features in input images. This is done server side using python and the computer
vision library OpenCV.</p>
</div><footer data-reactid="198"><section class="Byline animate" data-reactid="199"><a href="/" data-reactid="200"><svg class="Icon Monogram" viewBox="0 0 64 64" data-reactid="201"><path d="m 10.833,16.877 c -0.036,-2.862 2.141,-4.665 5.435,-4.076 3.294,0.589
      4.047,4.759 1.882,6.950 -2.941,2.945 -9.364,2.945 -12.234,-0.707
        -5.141,-6.361 1.494,-16.256 10.940,-15.432 6.329,0.568 11.034,7.386
      10.576,13.665 -0.314,4.241 -1.859,8.788 -4.000,12.958 -2.576,5.018
        -7.176,9.471 -12.940,9.659 -3.294,0.107 -6.894,-2.356 -6.352,-5.890
      0.699,-4.594 5.764,-6.997 9.999,-7.421 8.235,-0.821 16.469,0.941
      24.704,-0.019 7.105,-0.832 16.587,-3.934 20.469,-11.273 1.682,-3.192
      2.400,-7.197 -1.039,-9.930 -3.423,-2.721 -9.329,-0.954 -12.352,1.178
        -5.188,3.687 -7.788,10.354 -9.646,16.492 -3.200,10.590 -6.235,21.557
        -12.940,30.627 -2.823,3.840 -7.646,7.292 -12.940,6.125 -3.176,-0.699
        -6.823,-5.207 -5.964,-8.269 1.188,-4.241 4.823,-5.030 8.940,-5.478
      6.588,-0.703 14.352,3.510 19.057,7.386 4.094,3.428 9.164,7.516
      15.293,6.479 7.399,-1.249 11.999,-8.599 12.940,-15.314 0.736,-5.301
        -1.823,-11.250 -7.176,-12.958 -7.235,-2.309 -15.293,2.603 -16.469,9.659
        -0.669,3.899 2.812,7.033 6.470,7.657 4.341,0.749 8.505,-3.181
      7.882,-7.421 -0.463,-3.181 -7.658,-3.864 -7.752,0.958 -0.126,6.467
        -8.329,9.000 -13.411,8.022 -9.058,-1.767 -16.234,-12.251
        -16.822,-21.793 -1.000,-13.782 10.587,-28.036 28.115,-21.910
      2.882,1.008 6.258,4.335 6.917,6.785 1.412,5.207 0.755,8.458 1.553,12.015
      1.176,5.254 3.176,7.468 4.200,6.997 1.020,-0.464 1.306,-1.885
      1.259,-4.653 -0.074,-4.264 -0.921,-4.229 -2.882,-4.135 -2.588,0.126
        -8.129,0.707 -15.763,0.915 -2.835,0.077 -2.541,2.038 -2.800,2.061
        -6.035,0.349 -11.281,0.451 -13.999,0.756 l 0.289,0.588 c 6.294,-0.517
      10.634,-0.647 13.646,-0.813 0.135,4.818 1.388,6.055 4.576,6.279
      2.341,0.117 4.905,-0.914 5.905,-2.556 2.223,-3.652 1.235,-5.489
      3.811,-5.513 1.753,-0.018 3.588,5.560 4.776,8.505 1.089,2.709 3.529,5.843
      2.000,8.670 -1.294,2.391 -7.999,0.742 -7.999,0.742 0,0 1.270,3.887
        -0.259,3.887 -2.823,-0.007 -8.588,0.353 -10.117,-4.123 1.647,4.406
      7.294,4.123 10.117,4.123 1.176,1.120e-4 0.508,0.825 1.294,5.301
      0.414,2.356 0.672,4.783 -1.118,6.008 -5.894,4.040 -16.352,-1.649
        -20.822,-4.406 -4.376,-2.674 -8.811,-5.902 -11.764,-10.484
        -1.518,-2.368 0.765,-5.430 1.647,-6.008 -3.647,2.945 -4.882,-3.063
        -5.647,-6.008 -0.951,-3.652 0.229,-9.282 6.117,-8.128 3.764,0.735
      3.882,7.975 6.588,8.364 3.294,0.478 2.800,-6.585 1.529,-9.070
        -1.494,-2.933 -3.741,-6.585 -2.353,-9.895 1.318,-3.110 5.529,-2.544
      8.352,-2.120 4.117,0.615 9.340,2.780 13.646,1.133 3.764,-1.449
        -2.823,-6.550 -8.235,-7.598 -4.941,-0.931 -13.175,-2.603 -21.763,2.179
        -5.329,2.969 -8.717,8.481 -9.529,14.489 -1.223,9.070 2.447,17.081
      9.411,22.028 6.352,4.712 17.175,4.359 14.352,-7.775 -2.353,-10.013
        -17.410,-10.837 -17.528,-18.494 z" class="face" data-reactid="202"></path></svg></a><a class="text" href="/" data-reactid="203"><div class="name" data-reactid="204">Håken Lid</div><div class="about" data-reactid="205">Full stack web developer and designer</div></a><section class="SocialMedia" data-reactid="206"><a href="https://github.com/haakenlid" title="github" data-reactid="207"><svg class="Icon GitHub Social" viewBox="0 0 64 64" data-reactid="208"><path d="m 24.285,59.211 c -0.015,-1.577 -0.022,-7.273 -0.022,-8.462 l -1.077,0.190 c -3.962,0.731 -9.569,-0.038 -11.077,-4.462 l -0.465,-1.077 c -0.758,-1.758 -1.931,-3.158 -3.527,-4.192 l -0.328,-0.240 c -1.312,-0.927 -1.400,-1.977 0.562,-1.977 l 0.938,0.138 c 1.869,0.373 3.677,1.985 4.616,3.573 2.231,3.915 6.462,4.942 10.500,3.012 0.292,-2.100 1.058,-3.715 2.312,-4.846 -12.760,-1.346 -23.116,-16.347 -12.731,-27.501 -1.160,-2.846 -1.077,-6.769 0.300,-10.311 3.038,-0.938 7.577,2.077 9.962,3.720 5.846,-1.639 12.193,-1.639 18.039,0 l 1.792,-1.131 c 2.019,-1.246 5.616,-3.389 8.116,-2.589 1.408,3.542 1.538,6.731 0.372,9.577 10.385,11.193 -0.007,26.155 -12.808,27.501 1.627,1.415 2.450,3.639 2.450,6.692 l 0,12.287" data-reactid="209"></path></svg></a><a href="http://codepen.io/haakenlid/" title="codepen" data-reactid="210"><svg class="Icon CodePen Social" viewBox="0 0 64 64" data-reactid="211"><path d="m 4.428,23.059 27.885,18.577 0,18.577 L 4.428,41.636 m 27.885,0 27.885,-18.577 0,18.577 -27.885,18.577 m 27.885,-18.577 -27.885,-18.577 0,-18.577 27.885,18.577 m -27.885,0 -27.885,18.577 0,-18.577 L 32.313,4.482" data-reactid="212"></path></svg></a><a href="http://stackoverflow.com/users/1977847/?tab=profile" title="stack overflow" data-reactid="213"><svg class="Icon StackOverflow Social" viewBox="0 0 64 64" data-reactid="214"><path d="m 44.968,40.983 -27.462,-5.577 m 4.192,-12.847 25.270,11.808 m 3.754,-5.923 -21.424,-17.885 M 39.183,1.174 55.722,23.521 m -39.616,24.501 27.885,0 m -36.155,-8.346 0,19.539 44.232,0 0,-19.539" data-reactid="215"></path></svg></a></section></section></footer></main></article></div><script src="/bundle.js"></script></body></html>